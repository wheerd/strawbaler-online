# Internationalization (i18n)

This document provides an overview of Strawbaler's internationalization system.

For detailed developer workflows and tooling commands, see **[i18n Tooling Guide](./i18n-tooling.md)**.

## Current Status

âœ… **Implemented**: Locale-aware number formatting  
âœ… **Implemented**: Locale-aware input fields (LengthField)  
âœ… **Implemented**: UI string translations (10 namespaces)  
âœ… **Implemented**: Construction issue messages (errors/warnings)

## Supported Languages

- **English (en)** - Default
- **German (de)** - Full translation support

## Quick Start

### Using Translations in Components

```typescript
import { useTranslation } from 'react-i18next'

function MyComponent() {
  const { t } = useTranslation('common') // Specify namespace

  return (
    <div>
      <h1>{t('app.title')}</h1>
      <button>{t('actions.save')}</button>
    </div>
  )
}
```

### Using Formatters for Numbers

```typescript
import { useFormatters } from '@/shared/i18n/useFormatters'

function MyComponent() {
  const { formatLength, formatArea, formatWeight } = useFormatters()

  return (
    <div>
      <Text>Length: {formatLength(1234)}</Text>     {/* "1.234m" (EN) / "1,234m" (DE) */}
      <Text>Area: {formatArea(1500000)}</Text>      {/* "1.50mÂ²" (EN) / "1,50mÂ²" (DE) */}
      <Text>Weight: {formatWeight(500)}</Text>      {/* "500 kg" */}
    </div>
  )
}
```

### Using Formatters in Translation Strings

```json
{
  "measurements": {
    "wallHeight": "Wall height: {{height, length}}",
    "totalArea": "Total area: {{area, area}}"
  }
}
```

```typescript
// In component
t('measurements.wallHeight', { height: 2500 }) // "Wall height: 2.5m"
t('measurements.totalArea', { area: 1500000 }) // "Total area: 1.50mÂ²"
```

## Available Formatters

Custom formatters are available for use in both code and translation strings:

| Formatter        | Input         | Output Example (EN / DE) | Usage                     |
| ---------------- | ------------- | ------------------------ | ------------------------- |
| `length`         | Length in mm  | `1.234m` / `1,234m`      | Smart unit selection      |
| `lengthInMeters` | Length in mm  | `1.234m` / `1,234m`      | Always meters, 3 decimals |
| `area`           | Area in mmÂ²   | `1.50mÂ²` / `1,50mÂ²`      | Area in square meters     |
| `volume`         | Volume in mmÂ³ | `1.50mÂ³` / `1,50mÂ³`      | Volume in cubic meters    |
| `weight`         | Weight in kg  | `1,234 kg` / `1.234 kg`  | Auto kg/tonnes            |
| `dimensions2D`   | Array [w, h]  | `0.050m Ã— 0.100m`        | Cross-sections            |

## Namespaces

Translations are organized into namespaces by feature area:

| Namespace      | Purpose             | Example Keys                                  |
| -------------- | ------------------- | --------------------------------------------- |
| `common`       | Shared UI elements  | `actions.save`, `app.title`                   |
| `welcome`      | Welcome modal       | `introduction`, `keyFeatures.items`           |
| `toolbar`      | Main toolbar        | `tools.basicSelect`, `groups.perimeter`       |
| `inspector`    | Property inspectors | `perimeter.wallThickness`, `opening.width`    |
| `tool`         | Tool panels         | `addOpening.height`, `perimeter.wallAssembly` |
| `config`       | Configuration modal | `materials.add`, `walls.configure`            |
| `overlay`      | Plan overlay        | `planImport.step1.title`                      |
| `construction` | Construction views  | `tags.wall-part_post`, `measurements.wall`    |
| `errors`       | Error messages      | `boundary.title`, `construction.infill.*`     |
| `viewer`       | 3D viewer           | `export.ifc`, `grid.show`                     |

## Number Formatting

### Locale Differences

| Locale       | Decimal      | Thousands    | Example    |
| ------------ | ------------ | ------------ | ---------- |
| English (en) | `.` (period) | `,` (comma)  | `1,234.56` |
| German (de)  | `,` (comma)  | `.` (period) | `1.234,56` |

### LengthField Component

The `LengthField` component is fully locale-aware with **lenient input**:

- **Accepts both** `.` and `,` as decimal separators during typing
- **Formats on blur** using the correct locale separator
- **Live validation** with locale-aware parsing

```typescript
<LengthField
  value={1250}
  onChange={setLength}
  unit="cm"
  min={0}
  max={5000}
/>
```

**User experience:**

- English user types `12,5` â†’ formats to `12.5` on blur
- German user types `12.5` â†’ formats to `12,5` on blur
- Both inputs work regardless of locale during typing

## Language Switching

Users can switch languages via the **globe icon (ğŸŒ)** in the status bar.

The selected language is:

- Auto-detected from browser settings on first visit
- Saved to `localStorage` for persistence
- Applied to all translations and number formatting throughout the app

## File Structure

```
src/shared/i18n/
â”œâ”€â”€ config.ts              # i18next configuration and formatter registration
â”œâ”€â”€ formatters.ts          # Locale-aware number formatting functions
â”œâ”€â”€ formatters.test.ts     # Formatter tests
â”œâ”€â”€ useFormatters.ts       # React hook for formatters
â”œâ”€â”€ numberParsing.ts       # Locale-aware number parsing (for inputs)
â”œâ”€â”€ numberParsing.test.ts  # Number parsing tests
â””â”€â”€ locales/
    â”œâ”€â”€ en/               # English translations (10 namespaces)
    â”‚   â”œâ”€â”€ common.json
    â”‚   â”œâ”€â”€ welcome.json
    â”‚   â”œâ”€â”€ toolbar.json
    â”‚   â”œâ”€â”€ inspector.json
    â”‚   â”œâ”€â”€ tool.json
    â”‚   â”œâ”€â”€ config.json
    â”‚   â”œâ”€â”€ overlay.json
    â”‚   â”œâ”€â”€ construction.json
    â”‚   â”œâ”€â”€ errors.json
    â”‚   â””â”€â”€ viewer.json
    â””â”€â”€ de/               # German translations (10 namespaces)
        â””â”€â”€ ... (same structure)

src/@types/
â”œâ”€â”€ i18next.d.ts          # TypeScript module augmentation
â””â”€â”€ resources.d.ts        # Auto-generated: TypeScript types for all translations

i18next.config.ts         # i18next-cli configuration
```

## Developer Workflows

For detailed instructions on:

- Adding new translation keys
- Extracting keys from source code
- Generating TypeScript types
- Adding new languages
- Working with custom formatters
- Troubleshooting

See the **[i18n Tooling Guide](./i18n-tooling.md)**.

### Quick Reference

```bash
# Most common: Extract keys and update types
pnpm i18n:update

# Extract translation keys from source code
pnpm i18n:extract

# Generate TypeScript types from locale files
pnpm i18n:interface
```

## Technical Details

### Libraries

- **[i18next](https://www.i18next.com/)** (^25.7.3) - Core i18n framework
- **[react-i18next](https://react.i18next.com/)** (^16.5.0) - React bindings
- **[i18next-browser-languagedetector](https://github.com/i18next/i18next-browser-languagedetector)** (^8.2.0) - Auto-detect user language
- **[i18next-cli](https://github.com/i18next/i18next-cli)** (^1.33.5) - Extract translation keys
- **[i18next-resources-for-ts](https://github.com/LFDM/i18next-resources-for-ts)** (^2.0.0) - Generate TypeScript types

### Configuration

**Runtime configuration:** `src/shared/i18n/config.ts`

- Fallback language: English (`en`)
- Detection order: localStorage â†’ browser navigator
- Cache: localStorage
- Debug mode: Enabled in development (disabled in tests)

**Build-time configuration:** `i18next.config.ts`

- Supported locales: `en`, `de`
- Key extraction patterns
- Preserve patterns for dynamic keys
- Auto-removal of unused keys

## Testing

To test locale formatting:

1. Start dev server: `pnpm dev`
2. Open app in browser
3. Click globe icon (ğŸŒ) in status bar
4. Switch between English and German
5. Observe changes in:
   - All UI text
   - Number formatting in inspector panels
   - Input fields (type and blur to see formatting)
   - Parts lists and measurements

**Example differences:**

- English: `1.234m`, `1.50mÂ²`, `1,234 kg`
- German: `1,234m`, `1,50mÂ²`, `1.234 kg`

## Future Work

Potential enhancements:

- **Additional languages**: French, Spanish, etc.
- **Translation management**: Integration with Crowdin or similar
- **RTL support**: For Arabic/Hebrew if needed
- **Pluralization**: Advanced plural forms
- **Context-aware translations**: Same key, different contexts

---

**Last Updated**: January 2026  
**System Version**: i18next 25.7.3, react-i18next 16.5.0
